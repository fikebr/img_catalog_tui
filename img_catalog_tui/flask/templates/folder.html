{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block page_title %}{{ title }}{% endblock %}

{% block navigation %}
    <a href="/">Home</a>
    <a href="/folders">Folders</a>
    {% if not error %}
    <a href="/folder/{{ foldername }}/review/new">Review New</a>
    {% endif %}
{% endblock %}

{% block content %}
{% if error %}
    <div class="error-message">
        {{ error }}
    </div>
{% else %}
    <div class="section">
        <h2 class="section-title">Folder Information</h2>
        <div class="folder-path" style="font-family: var(--font-mono); background: var(--muted); padding: var(--space-sm); border-radius: var(--radius-sm); margin-bottom: var(--space-md); word-break: break-all;">{{ folder_data.foldername }}</div>
                    
        <div class="grid grid-2" style="margin-top: var(--space-md);">
            <div class="card">
                <div class="card-content text-center">
                    <div style="font-size: 2rem; font-weight: bold; color: var(--accent);">{{ folder_data.imageset_count }}</div>
                    <div style="font-size: 0.875rem; color: var(--text); opacity: 0.8;">Total Imagesets</div>
                </div>
            </div>
            <div class="card">
                <div class="card-content text-center">
                    <div style="font-size: 2rem; font-weight: bold; color: var(--accent);">
                        {% set new_count = namespace(value=0) %}
                        {% for imageset_name, imageset in folder_data.imagesets.items() %}
                            {% if imageset.status == "new" or imageset.status == "" %}
                                {% set new_count.value = new_count.value + 1 %}
                            {% endif %}
                        {% endfor %}
                        {{ new_count.value }}
                    </div>
                    <div style="font-size: 0.875rem; color: var(--text); opacity: 0.8;">New Imagesets</div>
                </div>
            </div>
        </div>
        
        <div style="margin-top: var(--space-lg); padding-top: var(--space-md); border-top: 1px solid var(--border);">
            <a href="/folder/{{ foldername }}/batch_update" class="btn btn-primary">
                ğŸ”„ Batch Update Imagesets
            </a>
        </div>
    </div>
                
    <div class="section">
        <h2 class="section-title">
            ğŸ“ Imagesets
        </h2>
        
        {% if folder_data.imagesets %}
            <div class="imagesets-grid">
                {% for imageset_name, imageset in folder_data.imagesets.items() %}
                    <div class="card">
                        <div class="card-header">
                            <h3 style="margin: 0; color: var(--accent); font-size: 1.1rem;">{{ imageset_name }}</h3>
                            <span class="status status-{{ imageset.status or 'new' }}">
                                {{ imageset.status or 'new' }}
                            </span>
                        </div>
                                    
                        <div class="card-content">
                            <div style="display: grid; gap: var(--space-sm);">
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-xs) 0; border-bottom: 1px solid var(--border);">
                                    <span style="font-size: 0.875rem; color: var(--text); opacity: 0.8;">Files</span>
                                    <span style="font-weight: 500; color: var(--accent);">{{ imageset.files|length }}</span>
                                </div>
                                
                                {% if imageset.source %}
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-xs) 0; border-bottom: 1px solid var(--border);">
                                    <span style="font-size: 0.875rem; color: var(--text); opacity: 0.8;">Source</span>
                                    <span style="font-weight: 500; text-align: right; max-width: 60%; word-break: break-word;">{{ imageset.source }}</span>
                                </div>
                                {% endif %}
                                
                                {% if imageset.edits %}
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-xs) 0; border-bottom: 1px solid var(--border);">
                                    <span style="font-size: 0.875rem; color: var(--text); opacity: 0.8;">Edits</span>
                                    <span style="font-weight: 500; text-align: right; max-width: 60%; word-break: break-word;">{{ imageset.edits }}</span>
                                </div>
                                {% endif %}
                                
                                {% if imageset.needs %}
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-xs) 0; border-bottom: 1px solid var(--border);">
                                    <span style="font-size: 0.875rem; color: var(--text); opacity: 0.8;">Needs</span>
                                    <span style="font-weight: 500; text-align: right; max-width: 60%; word-break: break-word;">{{ imageset.needs }}</span>
                                </div>
                                {% endif %}
                                
                                {% if imageset.posted_to %}
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-xs) 0;">
                                    <span style="font-size: 0.875rem; color: var(--text); opacity: 0.8;">Posted To</span>
                                    <span style="font-weight: 500; text-align: right; max-width: 60%; word-break: break-word;">{{ imageset.posted_to }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="card-footer">
                            <a href="/api/imageset/{{ foldername }}/{{ imageset_name }}" class="btn btn-secondary" target="_blank">API Data</a>
                            {% if imageset.cover_image %}
                            <a href="/images/{{ foldername }}/{{ imageset_name }}/{{ imageset.cover_image | basename }}" class="btn btn-primary" target="_blank">View Cover</a>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center" style="padding: var(--space-2xl); color: var(--text); opacity: 0.6;">
                <p>No imagesets found in this folder.</p>
            </div>
        {% endif %}
    </div>
{% endif %}
{% endblock %}
